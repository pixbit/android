package com.empsi.inepabor;

import java.io.InputStream;
import java.util.List;

import javax.xml.parsers.SAXParser;
import javax.xml.parsers.SAXParserFactory;

import org.xml.sax.InputSource;
import org.xml.sax.XMLReader;

import android.app.ListActivity;
import android.content.res.Resources;
import android.os.Bundle;
import android.util.Log;
import android.view.Menu;
import android.widget.ArrayAdapter;

public class MainListActivity extends ListActivity {

	protected String[] mItemNames = {
			"Item 1",
			"Item 2",
			"Item 3"
	};
	public static final String TAG = MainListActivity.class.getSimpleName();
	
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main_list);
        
        /* Create a new TextView to display the parsingresult later. */
//        TextView tv = new TextView(this);
        try {
                /* Get a SAXParser from the SAXPArserFactory. */
                SAXParserFactory spf = SAXParserFactory.newInstance();
                SAXParser sp = spf.newSAXParser();

                /* Get the XMLReader of the SAXParser we created. */
                XMLReader xr = sp.getXMLReader();
                /* Create a new ContentHandler and apply it to the XML-Reader*/
                PlistHandler myHandler = new PlistHandler();
                xr.setContentHandler(myHandler);

                /* Parse the xml-data from our URL. */
//                URL url = new URL("files:///android_asset/Data.plist");
//                xr.parse(new InputSource(url.openStream()));
                /* Parsing has finished. */
                
                /* Parse the xml-data from our file. */
                Resources res = getResources();
                InputStream is = res.openRawResource(R.raw.test);
                xr.parse(new InputSource(is));
                /* Parsing has finished. */

                /* Our ExampleHandler now provides the parsed data to us. */
                ParsedExampleDataSet parsedDataSet = myHandler.getParsedData();
                List<String> dataList = parsedDataSet.getList();
                
        		ListItem dataItem = new ListItem();
                for(int i = 0; i < dataList.size(); i++){
                 	boolean nextIsTitle = false;
                    boolean nextIsScroll = false;
                    boolean nextIsView = false;
                    boolean nextIsChild = false;

                    if(nextIsTitle){
                    	dataItem.setTitle(dataList.get(i));
                		nextIsTitle = false;
                	}
                	if(nextIsScroll){
                		dataItem.setScroll(dataList.get(i));
                		nextIsScroll = false;
                	}
                	if(nextIsView){
                		dataItem.setView(dataList.get(i));
                		nextIsView = false;
                	}
                	if(nextIsChild){
                		dataItem.hasChild = true;
                		nextIsChild = false;
                	}

                	if(dataItem.equals("Title")){
//                		startItem = true;
                		nextIsTitle = true;
                	}
                	if(dataItem.equals("Scroll")) nextIsScroll = true;
                	if(dataItem.equals("View")) nextIsView = true;
                	if(dataItem.equals("Children")) nextIsChild = true;
                }
                
                
                /* Set the result to be displayed in our GUI. */
//              Toast.makeText(this, parsedExampleDataSet.toString(), Toast.LENGTH_LONG).show();
              
              ArrayAdapter<String> adapter = new ArrayAdapter<String>(this, android.R.layout.simple_list_item_1, dataList);
              setListAdapter(adapter);
//                tv.setText(parsedExampleDataSet.toString());
               
        } catch (Exception e) {
                /* Display any Error to the GUI. */
//                tv.setText("Error: " + e.getMessage());
                Log.e(TAG, "XMLQueryError", e);
        }
        /* Display the TextView. */
//        this.setContentView(tv);
//        Toast.makeText(this, "parsedExample", Toast.LENGTH_LONG).show();
    }

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        // Inflate the menu; this adds items to the action bar if it is present.
        getMenuInflater().inflate(R.menu.activity_main_list, menu);
        return true;
    }
}